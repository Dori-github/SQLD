# 1-2. 데이터 모델과 성능
## 대량 데이터에 따른 성능 
### 1. 대량 데이터 발생에 따른 테이블 분할 개요
대량 데이터   하나 테이블에 집약, 하드웨어 한 공간에 저장시 성능 저하될 가능성이 높음  
→ 트랜 잭션이 분산 처리 되기 위한 분할 방법적용.  
![logo](http://www.dbguide.net/publishing/img/knowledge/SQL_103.jpg)
#### 대량의 데이터가 처리되는 테이블에 성능이 저하되는 이유
 SQL문장에서 데이터를 처리하기 위한 I/O의 양이 증가하기 때문. 

프로젝트를 수행할 때 하나의 테이블에 300개 이상 칼럼을 가지는 경우.
→ 로우체이닝, 로우마이그레이션 증가  
![](http://www.dbguide.net/publishing/img/knowledge/SQL_104.jpg)

로우체이닝(Row Chaining) : 로우 길이가 너무 길어서 데이터 블록 하나에 데이터가 모두 저장되지 않고, 두 개 이상의 블록에 걸쳐 하나 로우가 저장되어 있는 형태.

로우마이그라데이션(Row Migration): 데이터 블록에서 수정이 발생하면 수정된 데이터를 해당 데이터 블록에 저장하지 못하고, 다른 블록의 빈 공간을 찾아 저장하는 방식.

로우 체이닝, 로우마이그라이데이션 발생 ▶ 데이터 베이스 메모리 입출력 발생 시 I/O많이 발생 ▶ 성능 저하 

### 2. 한 테이블에 많은 수의 칼럼을 가지는 경우  
![logo](http://www.dbguide.net/publishing/img/knowledge/SQL_105.jpg)
많은 칼럼을 가지는 테이블에 대해서는 트랜잭션이 발생 시 어떤 칼럼에 집중적으로 발생하는지 분석하여 테이블을 쪼개면 디스크 I/O가 감소하여 성능이 개선됨.  
![logo](http://www.dbguide.net/publishing/img/knowledge/SQL_106.jpg)
분리된 테이블은 디스크에 적어진 칼럼이 저장이 되므로 로우마이그레이션과 로우체이닝 감소. 
### 3. 대량 데이터 저장 및 처리로 인한 성능 
테이블에 많은 양의 데이터 
 → 파티셔닝 적용 or PK에 의해 테이블을 분할하는 방법 적용 
 #### 파티셔닝 
 논리적으로 하나의 테이블로 보이지만, 물리적으로 여러 개의 테이블스페이스에 쪼개어 저장 될 수 있는 구조 
 #### [가. RANGE PARTITION 적용]
 
 RANGE PARTITION : 범위 나눠서. 년+월 이용하여 12개 파티션 테이블
 
 #### RANGE PARTITION 적용 대상
- 대상 테이블이 날짜 또는 숫자값으로 분리가 가능 한 경우
-  각 영역별로 트랜잭션이 분리가능할 때    
![logo](http://www.dbguide.net/publishing/img/knowledge/SQL_108.jpg)
RANGE PARTITION은 데이터보관주기에 따라 테이블에 데이터를 쉽게 지우는 것이 가능(파티션 테이블을 DROP.)  
→데이터 보관주기에 다른 테이블관리가 용이.
#### [나. LIST PARTITION 적용]
LIST PARTITION : 특정값 지정, 고객,서울,고객,인천 지점별 파티션테이블
#### LIST PARTITION 적용 대상
- 지점, 사업소, 사업장, 핵심적인 코드값 등으로 PK가 구성된 경우
-  대량의 데이터가 있는 테이블일 경우   
![logo](http://www.dbguide.net/publishing/img/knowledge/SQL_109.jpg)  
값 각각에 의해 파티셔닝 되는LIST PARTITION은 대용량 데이터를 특정값에 따라 분리 저장 가능.  
but,   
RANGE PARTITION과 같이 데이터 보관주기에 따라 쉽게 삭제하는 기능 제공X
#### [다. HASH PARTITION 적용]
HASH PARTITION: hash 조건 따라 해슁 알고리즘 적용되어 테이블 분리  
→ 데이터 보관주기에 따라 쉽게 삭제하는 기능 제공X 
### 4. 테이블에 대한 수평분할/수직분할 절차 
1) 데이터 모델링을 완성한다.  
2) 데이터베이스 용량산정을 한다. 
(어느 테이블에 데이터의 양이 대용량 되는지 분석하는 것)
3) 대량 데이터가 처리되는 테이블에 대해서 트랜잭션 처리 패턴을 분석한다.  
4) 칼럼 단위로 집중화된 처리가 발생하는지, 로우단위로 집중화된 처리가 발생되는지 분석하여 집중화된 단위로 테이블을 분리하는 것을 검토한다.  
(파티셔닝 고려하여, 기준에 따라 적용)
## 데이터베이스 구조와 성능
### 1. 슈퍼/서브 타입 모델 성능 고려 방법
#### [가. 슈퍼/서브 타입 데이터 모델 개요]
슈퍼타입 : 공통 부분 
서브타입 : 공통으로 부터 상속받아 다른 엔터티와 차이가 있는 속성에 대해 별도로 구분 
슈퍼/서브 타입 : 논리적 데이터 모델에서 이용되는 형태, 분석 단계에서 많이 쓰이는 모델. 그러므로 설계단계에서 변환이 필요함. 
변환기준 : 데이터양/트랜잭션 유형
## 대량 데이터에 따른 성능 
### 1. 대량 데이터 발생에 따른 테이블 분할 개요
대량 데이터   하나 테이블에 집약, 하드웨어 한 공간에 저장시 성능 저하될 가능성이 높음  
→ 트랜 잭션이 분산 처리 되기 위한 분할 방법적용.  
![logo](http://www.dbguide.net/publishing/img/knowledge/SQL_103.jpg)
#### 대량의 데이터가 처리되는 테이블에 성능이 저하되는 이유
 SQL문장에서 데이터를 처리하기 위한 I/O의 양이 증가하기 때문. 

프로젝트를 수행할 때 하나의 테이블에 300개 이상 칼럼을 가지는 경우.
→ 로우체이닝, 로우마이그레이션 증가   
![](http://www.dbguide.net/publishing/img/knowledge/SQL_104.jpg)

로우체이닝(Row Chaining) : 로우 길이가 너무 길어서 데이터 블록 하나에 데이터가 모두 저장되지 않고, 두 개 이상의 블록에 걸쳐 하나 로우가 저장되어 있는 형태.

로우마이그라데이션(Row Migration): 데이터 블록에서 수정이 발생하면 수정된 데이터를 해당 데이터 블록에 저장하지 못하고, 다른 블록의 빈 공간을 찾아 저장하는 방식.

로우 체이닝, 로우마이그라이데이션 발생 ▶ 데이터 베이스 메모리 입출력 발생 시 I/O많이 발생 ▶ 성능 저하 

### 2. 한 테이블에 많은 수의 칼럼을 가지는 경우  
![logo](http://www.dbguide.net/publishing/img/knowledge/SQL_105.jpg)
많은 칼럼을 가지는 테이블에 대해서는 트랜잭션이 발생 시 어떤 칼럼에 집중적으로 발생하는지 분석하여 테이블을 쪼개면 디스크 I/O가 감소하여 성능이 개선됨.
![logo](http://www.dbguide.net/publishing/img/knowledge/SQL_106.jpg)  
분리된 테이블은 디스크에 적어진 칼럼이 저장이 되므로 로우마이그레이션과 로우체이닝 감소. 
### 3. 대량 데이터 저장 및 처리로 인한 성능 
테이블에 많은 양의 데이터 
 → 파티셔닝 적용 or PK에 의해 테이블을 분할하는 방법 적용 
 #### 파티셔닝 
 논리적으로 하나의 테이블로 보이지만, 물리적으로 여러 개의 테이블스페이스에 쪼개어 저장 될 수 있는 구조 
 #### [가. RANGE PARTITION 적용]
 
 RANGE PARTITION : 범위 나눠서. 년+월 이용하여 12개 파티션 테이블
 
 #### RANGE PARTITION 적용 대상
- 대상 테이블이 날짜 또는 숫자값으로 분리가 가능 한 경우
-  각 영역별로 트랜잭션이 분리가능할 때  
![logo](http://www.dbguide.net/publishing/img/knowledge/SQL_108.jpg)
RANGE PARTITION은 데이터보관주기에 따라 테이블에 데이터를 쉽게 지우는 것이 가능(파티션 테이블을 DROP.) 
→데이터 보관주기에 다른 테이블관리가 용이.
#### [나. LIST PARTITION 적용]
LIST PARTITION : 특정값 지정, 고객,서울,고객,인천 지점별 파티션테이블
#### LIST PARTITION 적용 대상
- 지점, 사업소, 사업장, 핵심적인 코드값 등으로 PK가 구성된 경우
-  대량의 데이터가 있는 테이블일 경우   
![logo](http://www.dbguide.net/publishing/img/knowledge/SQL_109.jpg)
값 각각에 의해 파티셔닝 되는LIST PARTITION은 대용량 데이터를 특정값에 따라 분리 저장 가능.  
but,   
RANGE PARTITION과 같이 데이터 보관주기에 따라 쉽게 삭제하는 기능 제공X
#### [다. HASH PARTITION 적용]
HASH PARTITION: hash 조건 따라 해슁 알고리즘 적용되어 테이블 분리  
→ 데이터 보관주기에 따라 쉽게 삭제하는 기능 제공X 
### 4. 테이블에 대한 수평분할/수직분할 절차 
1) 데이터 모델링을 완성한다.  
2) 데이터베이스 용량산정을 한다. 
(어느 테이블에 데이터의 양이 대용량 되는지 분석하는 것)
3) 대량 데이터가 처리되는 테이블에 대해서 트랜잭션 처리 패턴을 분석한다.  
4) 칼럼 단위로 집중화된 처리가 발생하는지, 로우단위로 집중화된 처리가 발생되는지 분석하여 집중화된 단위로 테이블을 분리하는 것을 검토한다.
(파티셔닝 고려하여, 기준에 따라 적용) 논리적인 데이터 모델에서 이용되고 분석 단계에서 많이 쓰이는 모델이므로 물리적 데이터 모델 설계 단계에서 슈퍼/서브 타입 데이터 모델을 일정한 기준에 의해 변환해야함.
## 데이터베이스 구조와 성능
### 1. 슈퍼/서브 타입 모델 성능고려 방법
#### [가. 슈퍼/서브타입 데이터 모델 개요]
슈퍼타입 : 공통 부분   
서브타입 : 공통으로 부터 상속받아 다른 엔터티와 차이가 있는 속성에 대해 별도로 구분   
슈퍼/서브 타입 : 논리적 데이터 모델에서 이용되는 형태, 분석 단계에서 많이 쓰이는 모델. 그러므로 설계단계에서 변환이 필요함. 
변환기준 : 데이터양/트랜잭션 유형
#### [나. 슈퍼/서브 타입의 변환]  
![logo](http://www.dbguide.net/publishing/img/knowledge/SQL_110.jpg)
#### 슈퍼 서브 타입 잘못된 변환시 성능 저하 이유
1. 트랜 잭션은 항상 일괄로 처리 하는데 테이블은 개별로 유지되어 Union연산에 의해 성능 저하
2. 트랜잭션은 항상 서브타입 개별로 처리하는데 테이블은 하나로 통합되어 있어 불필요하게 많은 양의 데이터가 집양되어 있기 때문
3. 트랜잭션은 항상 슈퍼+서브 타입을 공통으로 처리하는데 개별 유지되어 있거나 하나의 테이블로 집약되어 있기 때문
#### [다. 슈퍼/서브 타입 데이터 모델 변환기술]
#### 슈퍼타입/서브타입 물리적인 데이터 모델 변환 유형
1, 개별로 발생되는 트랜잭션은 개별 테이블로 구성
2. 슈퍼타입+서브타입에 대해 발생되는 트랜 잭션은 슈퍼+서브타입 테이블로 구성.  
![logo](http://www.dbguide.net/publishing/img/knowledge/SQL_113.jpg)
3. 전체를 하나로 묶어 트랜잭션이 발생 할 때는 하나의 테이블로 구성. 
#### [라. 슈퍼/서브타입 데이터 모델 변환타입 비교]  
![logo](http://www.dbguide.net/publishing/img/knowledge/SQL_114.jpg)
### 2. 인덱스 특성을 고려한 PK/FK 데이터 베이스 성능 향상 
#### PK/FK 칼럼 순서와 성능 개요
인덱스 : PK/FK 칼럼 순서와 성능 개요 데이터 조회 시 가장 효과적으로 처리되도록 접근경로를 제공하는 오브젝트  
![](http://www.dbguide.net/publishing/img/knowledge/SQL_115.jpg)
PK/FK 칼럼 순서 중요, FK 칼럼 인덱스 컬럼화 필요. 
## 분산 데이터베이스와 성능
### 1. 분산데이터베이스 개요
#### 분산데이터베이스 정의
1. 여러 곳으로 분산되어있는 데이터베이스를 하나의 가상 시스템으로 사용할 수 있도록 한 데이터베이스
2. 논리적으로 동일한 시스템에 속하지만, 컴퓨터 네트워크를 통해 물리적으로 분산되어 있는 데이터들의 모임
3. 물리적 Site 분산, 논리적으로 사용자 통합 공유
### 2. 분산 데이터베이스의 투명성(Transparency)
1) 분할 투명성 (단편화) : 하나의 논리적 Relation이 여러 단편으로 분할되어 각 단편의 사본이 여러 site에 저장  
2) 위치 투명성 : 사용하려는 데이터의 저장 장소 명시 불필요. 위치정보가 System Catalog에 유지되어야 함  
3) 지역사상 투명성 : 지역DBMS와 물리적 DB사이의 Mapping 보장. 각 지역시스템 이름과 무관한 이름 사용 가능  
4) 중복 투명성 : DB 객체가 여러 site에 중복 되어 있는지 알 필요가 없는 성질  
5) 장애 투명성 : 구성요소(DBMS, Computer)의 장애에 무관한 Transaction의 원자성 유지  
6) 병행 투명성 : 다수 Transaction 동시 수행시 결과의 일관성 유지, Time Stamp, 분산 2단계 Locking을 이용 구현
### 3. 분산 데이터베이스 적용방법 및 장단점
#### [가. 분산 데이터베이스 적용방법]
업무 흐름을 보고 업무 구성에 따른 아키텍처의 특징에 따라 데이터베이스를 구성해야 한다. 
#### [나. 분산 데이터베이스 장단점]  
![](http://www.dbguide.net/publishing/img/knowledge/SQL_129.jpg)
### 4. 분산 데이터베이스의 활용방향성  
![](http://www.dbguide.net/publishing/img/knowledge/SQL_130.jpg)
업무 특징에 따라 분산 데이터베이스를 활용하는 기술이 필요하다. 
### 5. 데이터베이스 분산구성 가치
데이터를 분산 환경으로 구성 시 가장 핵심적인 가치는 통합된 데이터베이스에서 제공할 수 없는 빠른 성능을 제공한다는 점이다. 
![](http://www.dbguide.net/publishing/img/knowledge/SQL_131.jpg)  
### 6. 분산 데이터베이스의 적용 기법
데이터베이스의 분산의 종류에는 테이블 위치 분산과 테이블 분할 분산, 테이블 복제 분산, 테이블 요약 분산 전략이 있다.   
그 중에서 가장 많이 사용하는 방식은  테이블의 복제 분할 분산법이다. 
#### [가. 테이블 위치 분산]
테이블 위치 분산 : 테이블 구조 변하지X, 다른 데이터베이스에 중복되어 생성X, 테이블 위치를 다르게 지정.
→ 이용하는 형태가 각 위치별로 차이가 있을 경우 이용.
![](http://www.dbguide.net/publishing/img/knowledge/SQL_132.jpg)  
[그림 Ⅰ-2-41]의 분산방법은 설계된 테이블 각각이 지역별로 분산되어 생성되는 경우이다.  
각각의 테이블마다 위치가 다르게 지정되어야 한다면 [그림 Ⅰ-2-42]의 표와 같이 각각 테이블마다 위치를 표기하여 테이블을 생성하도록 함.
#### [나. 테이블 분할 분산]
테이블 분할 분산 : 각각 테이블을 쪼개어 분산
#### 수평 분할 
![](http://www.dbguide.net/publishing/img/knowledge/SQL_134.jpg)  
1. 테이블을 로우 단위로 분리,
2. 칼럼은 분리 되어 있지 않은 형태를 가짐
3. 중복이 발생 되지 않음
4. 지사 별 로우가 다를 때 이용
5. 통합 처리 시 조인이 발생하여 성능 저하가 예상 되므로 통합 처리 프로세스가 많은지 검토한 이후에 많지 않은 경우 사용.
#### 수직 분할 
![](http://www.dbguide.net/publishing/img/knowledge/SQL_136.jpg)  
1. 테이블을 칼럼 단위로 분할 , 로우 단위 분할X 
2. 모든 데이터가 각 지사로 분리된 형태
3. Primary Key 구조와 값을 가지고 있는 형태
4. Primary Key가 동일한 데이터 조합이 가능해야 하며, 하나의 안전한 테이블이 구성되어야함.
5.  Primary Key 하나로 통합되므로 중복성X 
#### [다. 테이블 복제 분산]
테이블 복제 분산 : 동일한 테이블을 다른 지역이나 서버에 동시에서 관리
- 부분복제: 통합 된 건 본사, 각 지사별로 해당 로우
-광역복제: 본사, 지사 모두 동일한 데이터 가짐
#### 부분복제
![](http://www.dbguide.net/publishing/img/knowledge/SQL_138.jpg)  
지사에서 데이터 처리 용이,여러테이블에 조인이 발생하지 않아 빠른 작업 수행 가능 (전체 데이터 통합 처리)
![](http://www.dbguide.net/publishing/img/knowledge/SQL_139.jpg)  
#### 광역복제
![](http://www.dbguide.net/publishing/img/knowledge/SQL_140.jpg)  
 지사-본사 데이터 량 동일, 동일 정보를 가지고 있으므로 본사/지사 데이터 처리 특별한 제약X
![](http://www.dbguide.net/publishing/img/knowledge/SQL_141.jpg)  
부분복제의 경우는 지사에서 데이터에 대한 입력, 수정, 삭제가 발생하여 본사에서 이용하는 방식이 많은 반면 광역복제는 본사에서 데이터가 입력, 
수정, 삭제가 되어 지사에서 이용하는 형태가 차이점이다.  부분 복사와 마찬가지로 실시간 처링 의해 복사하는 것 보다 배치에 의해 복사가 되도록 한다.
#### [라. 테이블 요약 분산]
- 분석 요약 : 각 지사별로 요약, 본사에 통합  
- 통합 요약 : 각 지사별로 존재하는 다른 내용이 정보요약, 본사에 통합
#### 분석요약  
![](http://www.dbguide.net/publishing/img/knowledge/SQL_142.jpg)
![](http://www.dbguide.net/publishing/img/knowledge/SQL_143.jpg)  
통합 통계데이터에 대한 정보제공에 용이한 분산방법이다.
#### 통합요약  
![](http://www.dbguide.net/publishing/img/knowledge/SQL_144.jpg)
![](http://www.dbguide.net/publishing/img/knowledge/SQL_145.jpg)  
본사에 통계데이터를 산정하는 유형은 분석요약과 비슷하나 통합요약은 지사에서 산출한 요약정보를 한군데 취합하여 보여주는 형태이다.
 분석요약은 지사에 있는 데이터를 이용하여 본사에서 통합하여 요약 데이터를 산정하였지만 통합요약에서는 지사에서 요약한 정보를 본사에서 취합하여 각 지사별로 데이터를 비교하기 위해 이용되는 것이다
 ### 7. 분산 데이터베이스를 적용하여 성능이 향상 된 사례
 복제분산의 원리를 간단하게 응용하면 많은 업무적인 특성이 있는 곳에서 그 성능을 향상시켜 설계할 수 있다.  
![](http://www.dbguide.net/publishing/img/knowledge/SQL_146.jpg)
#### 분석 설계 적용 시 효과적인 경우
 -   성능이 중요한 사이트에 적용해야 한다.
-   공통코드, 기준정보, 마스터 데이터 등에 대해 분산환경을 구성하면 성능이 좋아진다.
-   실시간 동기화가 요구되지 않을 때 좋다. 거의 실시간(Near Real Time)의 업무적인 특징을 가지고 있을 때도 분산 환경을 구성할 수 있다
-   특정 서버에 부하가 집중이 될 때 부하를 분산할 때도 좋다.
-   백업 사이트(Disaster Recovery Site)를 구성할 때 간단하게 분산기능을 적용하여 구성할 수 있다.
